<div class="container product-page">

  <!-- Kategori Tab Bar -->
  <div class="category-tabs mb-4" *ngIf="categories?.length">
    <button
      *ngFor="let c of categories"
      class="category-tab"
      [class.active]="selectedCategory === c"
      (click)="selectedCategory = c">
      {{ c }}
    </button>
  </div>

  <!-- Admin: Yeni ÃœrÃ¼n Ekle -->
  <div class="d-flex justify-content-end mb-3">
    <button class="btn btn-primary"
            (click)="onCreate()">
      {{ showCreateForm ? 'Ä°ptal' : 'Yeni ÃœrÃ¼n Ekle' }}
    </button>
  </div>

  <!-- Create Form -->
  <div *ngIf="showCreateForm && token.hasRole('ROLE_ADMIN')" class="product-form card p-3 shadow-sm mb-4">
    <form #productForm="ngForm" novalidate>
      <div class="row g-3">
        <div class="col-md-4">
          <input class="form-control" name="name" placeholder="ÃœrÃ¼n adÄ±" required
                 [(ngModel)]="newProduct.name" #nameCtrl="ngModel" />
        </div>
        <div class="col-md-4">
          <input class="form-control" name="price" type="number" min="0" step="0.01"
                 placeholder="Fiyat" required [(ngModel)]="newProduct.price" />
        </div>
        <div class="col-md-4">
          <input class="form-control" name="description" placeholder="AÃ§Ä±klama" required
                 [(ngModel)]="newProduct.description"/>
        </div>
        <div class="col-md-3">
          <select class="form-select" name="category" required [(ngModel)]="newProduct.category">
            <option *ngFor="let c of categories" [ngValue]="c">{{ c }}</option>
          </select>
        </div>
        <div class="col-md-1">
          <button class="btn btn-success w-100" type="submit" [disabled]="productForm.invalid">Kaydet</button>
        </div>
      </div>
    </form>
  </div>

  <!-- ÃœrÃ¼n Listesi -->
  <div *ngIf="selectedCategory && groupedProducts[selectedCategory]?.length" class="row g-3">
    <div class="col-md-4" *ngFor="let p of groupedProducts[selectedCategory]">
      <div class="product-card shadow-sm p-3">
        <h6 class="mb-1">{{ p.name }}</h6>
        <div class="text-muted small mb-2">ðŸ’° {{ p.price | currency:'TRY ':'symbol':'1.2-2' }}</div>

        <div class="d-flex justify-content-end gap-2">
          <button class="btn btn-outline-primary btn-sm"  (click)="onEdit(p.id)">DÃ¼zenle</button>
          <button class="btn btn-outline-danger btn-sm"  (click)="onDelete(p.id)">Sil</button>
        </div>
      </div>
    </div>
  </div>

  <div *ngIf="selectedCategory && (!groupedProducts[selectedCategory] || !groupedProducts[selectedCategory].length)"
       class="text-muted text-center mt-5">
    Bu kategoride Ã¼rÃ¼n bulunamadÄ±.
  </div>

</div>
